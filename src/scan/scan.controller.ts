import {
  BadRequestException,
  Body,
  Controller,
  HttpCode,
  NotImplementedException,
  Post,
} from '@nestjs/common';
import { ScanService } from './scan.service.js';
import { ScanDependencies } from './dto/scan.dto.js';

@Controller('scan')
export class ScanController {
  constructor(private readonly scanService: ScanService) {}

  @Post()
  @HttpCode(200)
  async scanDependencies(@Body() { ecosystem, fileContent }: ScanDependencies) {
    try {
      switch (ecosystem) {
        case 'NPM':
          return this.scanService.npm(fileContent);
        default:
          throw new NotImplementedException();
      }
    } catch (error) {
      if (error instanceof Error) {
        if (error.message === 'INVALID_PACKAGE_MANAGER') {
          throw new BadRequestException('Invalid package manager');
        }
      }
    }
  }
}
