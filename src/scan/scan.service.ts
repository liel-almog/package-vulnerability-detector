import { Injectable } from '@nestjs/common';
import { Ecosystem } from '../models/ecosystem.model.js';
import { VulnerabilitiesDetectorService } from '../vulnerabilities-detector/vulnerabilities-detector.service.js';
import { VulnerablePackage } from '../vulnerabilities-detector/models/vulnerablePackage.type.js';

@Injectable()
export class ScanService {
  constructor(
    private readonly vulnerabilitiesDetector: VulnerabilitiesDetectorService,
  ) {}

  async scanDependencies(ecosystem: Ecosystem, definitionFile: string) {
    const vulnerablePackages: VulnerablePackage[] =
      await this.vulnerabilitiesDetector.detectVulnerabilities(
        ecosystem,
        definitionFile,
      );

    return {
      vulnerablePackages,
    };
  }
}
