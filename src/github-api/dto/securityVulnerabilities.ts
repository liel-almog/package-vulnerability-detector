import { z } from 'zod';
import { ECOSYSTEMS } from '../../models/ecosystem.model.js';

export const VULNERABLE_SEVERITIES = [
  'LOW',
  'MODERATE',
  'HIGH',
  'CRITICAL',
] as const;

export type VulnerableSeverity = (typeof VULNERABLE_SEVERITIES)[number];

export const securityVulnerabilityNodeSchema = z.object({
  severity: z.enum(VULNERABLE_SEVERITIES),
  firstPatchedVersion: z.object({
    identifier: z.string(),
  }),
  package: z.object({
    ecosystem: z.enum(ECOSYSTEMS),
    name: z.string(),
  }),
  vulnerableVersionRange: z.string(),
});

export const packageSecurityVulnerabilitiesSchema = z.object({
  nodes: z.array(securityVulnerabilityNodeSchema),
});

export const securityVulnerabilities = z.record(
  z.string(),
  packageSecurityVulnerabilitiesSchema,
);
